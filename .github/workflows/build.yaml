name: 'build'

on:
  pull_request:
    branches:
    - main
  workflow_dispatch:

jobs:
  build:
    name: Build
    runs-on: macos-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v3

    - name: install from Brewfile
      run: |
        MAS_APPS="$(cat Brewfile | grep -v brew | grep mas | sed 's/^.*"\(.*\)".*$/\1/' | tr '\n' ' ')"
        export HOMEBREW_BUNDLE_MAS_SKIP="$MAS_APPS"
        export HOMEBREW_BUNDLE_BREW_SKIP="awscli go"
        brew bundle

    - name: Check result
      run: cat Brewfile.lock.json
